name: Update etherpad to latest version
on:
  schedule:
    - cron: "0 10 * * *"
jobs:
  update-etherpad:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Fetch release version
        id: fetch-version
        run: |
          TAG_NAME=$(curl -sL https://api.github.com/repos/swagger-api/swagger-ui/releases/latest | jq -r ".tag_name")
          echo ::set-output name=release_tag::$TAG_NAME
          echo $TAG_NAME > etherpad-versions/current.txt
      - name: Check for modified files
        id: git-check
        run: echo ::set-output name=modified::$([ -z "`git status --porcelain`" ] && echo "false" || echo "true")
      - name: Create Pull Request
        if: steps.git-check.outputs.modified == 'true'
        uses: peter-evans/create-pull-request@v4
        with:
          commit-message: Update Etherpad to ${{ steps.fetch-version.outputs.release_tag }}
          title: Update Etherpad to ${{ steps.fetch-version.outputs.release_tag }}
          body: |
            Update etherpad to latest version

            Auto-generated by [create-pull-request](https://github.com/peter-evans/create-pull-request)
          labels: dependencies, automated pr
          branch: etherpad-updates
